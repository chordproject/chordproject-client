<div class="flex w-full flex-col">
    <!-- View mode -->
    @if (!editMode) {
        <!-- Header -->
        <div
            class="relative w-full bg-accent-100 px-8 sm:px-12 dark:bg-accent-700"
        >
            <!-- Header flex row: title + action left, close right -->
            <div
                class="mx-auto flex w-full max-w-3xl items-start justify-between pb-3 pt-3"
            >
                <!-- Left: Title + Action -->
                <div class="flex min-w-0 items-center">
                    <div
                        class="min-w-0 max-w-xs truncate text-4xl font-bold sm:max-w-md md:max-w-lg"
                    >
                        {{ song.title }}
                    </div>
                    <button
                        mat-stroked-button
                        class="ml-4 flex-shrink-0"
                        (click)="toggleEditMode(true)"
                    >
                        <mat-icon
                            class="icon-size-5"
                            [svgIcon]="'heroicons_solid:pencil-square'"
                        ></mat-icon>
                        <span class="ml-2">Edit</span>
                    </button>
                </div>
                <!-- Right: Close button -->
                <a
                    mat-icon-button
                    [matTooltip]="'Close'"
                    [routerLink]="['../']"
                    class="flex-shrink-0"
                >
                    <mat-icon
                        class="text-white"
                        [svgIcon]="'heroicons_outline:x-mark'"
                    ></mat-icon>
                </a>
            </div>

            <!-- Tags -->
            @if (song.tags?.length) {
                <div class="mt-2 flex flex-wrap items-center">
                    <!-- Tag -->
                    @for (
                        tag of song.tags | fuseFindByKey: 'id' : tags;
                        track trackByFn($index, tag)
                    ) {
                        <div
                            class="mb-3 mr-3 flex items-center justify-center rounded-full bg-gray-100 px-3 py-1 leading-normal text-gray-500 dark:bg-gray-700 dark:text-gray-300"
                        >
                            <span
                                class="whitespace-nowrap text-sm font-medium"
                                >{{ tag.title }}</span
                            >
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Song -->
        <div
            class="relative flex flex-auto flex-col items-center p-6 pt-0 sm:p-12 sm:pt-0"
        >
            <div class="w-full max-w-3xl">
                <chp-viewer #viewer [content]="song.content"> </chp-viewer>
            </div>
        </div>
    }

    <!-- Edit mode -->
    @if (editMode) {
        <chp-editor [(content)]="song.content" tabindex="0"></chp-editor>
    }
</div>
